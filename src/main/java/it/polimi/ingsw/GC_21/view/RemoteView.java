package it.polimi.ingsw.GC_21.VIEW;import java.awt.Insets;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.io.IOException;import java.io.ObjectOutputStream;import java.io.PrintStream;import java.net.Socket;import java.util.Scanner;import java.util.ArrayList;import java.util.ResourceBundle.Control;import java.util.concurrent.Callable;import org.json.simple.parser.ParseException;import org.omg.CORBA.Current;import org.omg.PortableInterceptor.SYSTEM_EXCEPTION;import org.omg.PortableServer.AdapterActivator;import it.polimi.ingsw.GC_21.ACTION.Action;import it.polimi.ingsw.GC_21.ACTION.CouncilPlacement;import it.polimi.ingsw.GC_21.ACTION.CraftAction;import it.polimi.ingsw.GC_21.ACTION.CraftPlacement;import it.polimi.ingsw.GC_21.ACTION.ExcommAction;import it.polimi.ingsw.GC_21.ACTION.MarketPlacement;import it.polimi.ingsw.GC_21.ACTION.TowerPlacement;import it.polimi.ingsw.GC_21.BOARD.Color;import it.polimi.ingsw.GC_21.BOARD.CraftType;import it.polimi.ingsw.GC_21.CLIENT.ChooseActionMessage;import it.polimi.ingsw.GC_21.CLIENT.MessageToClient;import it.polimi.ingsw.GC_21.CLIENT.RmiClient;import it.polimi.ingsw.GC_21.CLIENT.RmiClientInterface;import it.polimi.ingsw.GC_21.CLIENT.StartMessage;import it.polimi.ingsw.GC_21.CLIENT.TurnMessage;import it.polimi.ingsw.GC_21.CONTROLLER.Controller;import it.polimi.ingsw.GC_21.CONTROLLER.ControllerForm;import it.polimi.ingsw.GC_21.CONTROLLER.ControllerManager;import it.polimi.ingsw.GC_21.CONTROLLER.LoginController;import it.polimi.ingsw.GC_21.GAMECOMPONENTS.DevCardType;import it.polimi.ingsw.GC_21.GAMEMANAGEMENT.Age;import it.polimi.ingsw.GC_21.GAMEMANAGEMENT.Game;import it.polimi.ingsw.GC_21.GAMEMANAGEMENT.Round;import it.polimi.ingsw.GC_21.GAMEMANAGEMENT.Turn;import it.polimi.ingsw.GC_21.PLAYER.FamilyMember;import it.polimi.ingsw.GC_21.PLAYER.FamilyMemberColor;import it.polimi.ingsw.GC_21.PLAYER.Player;import it.polimi.ingsw.GC_21.UTILITIES.Observable;import it.polimi.ingsw.GC_21.UTILITIES.P2SObserver;import it.polimi.ingsw.GC_21.UTILITIES.CurrentObserver;public class RemoteView extends Observable<Action> implements P2SObserver, CurrentObserver, Runnable {	private Game game;	private Player player;	private AdapterConnection adapterConnection;	private String username;	// in the declaration of remote View we create the controller passing the	// controller manager	public RemoteView(AdapterConnection adapter, ControllerManager controllerManager) throws IOException {		this.adapterConnection = adapter;		Controller controller = new Controller(this, controllerManager);	}	@Override	public void run() {		StartMessage startMessage = new StartMessage();		adapterConnection.sendObject(startMessage);		inputObject();	}	public void inputObject() {		InputForm inputFromView = adapterConnection.receiveObject();		inputFromView.execute(this);	}	public void response(Action action) {		boolean result = this.notifyObservers(action);		if (result == false) {			ChooseActionMessage retryActionMessage = new ChooseActionMessage(false, "Oh bischero! Something went wrong! Try again!",  player);			adapterConnection.sendObject(retryActionMessage);			inputObject();			return;		}		return;	}	public String getUsername() {		return username;	}	public void setUsername(String username) {		this.username = username;	}	public Game getGame() {		return game;	}	public void setGame(Game game) {		this.game = game;	}	public Player getPlayer() {		return player;	}	public void setPlayer(Player player) {		this.player = player;	}	public AdapterConnection getAdapter() {		return adapterConnection;	}	public void setAdapter(AdapterConnection adapter) {		this.adapterConnection = adapter;	}	@Override	public void updateTurn() {		game.attachCurrent(this);		Age currentAge = game.getCurrentAge();		Round currentRound = currentAge.getCurrentRound();		Turn currentTurn = currentRound.getCurrentTurn();		String description = "Age: "+ currentAge.getAgeNumber() + " Round: " + currentRound.getRoundNumber() 				+" Turn: "+ currentTurn.getTurnNumber() +" Turn of player : "+ player.getName() +" color: " + player.getPlayerColor().toString();		TurnMessage turnMessage = new TurnMessage(game.getBoard(), game.getPlayers(), 				currentAge.getAgeNumber(), currentRound.getRoundNumber(), 				currentTurn.getTurnNumber(), description);		game.notifyBroadcast(turnMessage);		ChooseActionMessage chooseAction = new ChooseActionMessage(true, "It's your turn!", player);		adapterConnection.sendObject(chooseAction);		inputObject();	}			@Override	public boolean update(Object change) {		return true;	}		@Override	public boolean updateMessage(ControllerForm message) {		return true;	}	@Override	public void updateCurrent(MessageToClient messageToClient) {		adapterConnection.sendObject(messageToClient);		if (messageToClient.isWaiting()){			this.inputObject();		}	}	@Override	public void updateBroadcast(MessageToClient message) {		adapterConnection.sendObject(message);		if (message.isWaiting()){			this.inputObject();		}	}					}